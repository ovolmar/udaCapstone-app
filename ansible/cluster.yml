---

- hosts: localhost
  tasks:
    - name: "Fetching kubectl"
      shell: |
          curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
          sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
          
    - name: "Deploying application to EKS"
      shell: |
        /usr/local/bin/aws eks update-kubeconfig --name udacapstone-k8s-cluster --region ${AWS_DEFAULT_REGION} 
        kubectl apply -f infrastructure/bluepod.yml
        kubectl apply -f infrastructure/blue-services.yml
        kubectl apply -f infrastructure/ingress.yml
        kubectl expose deployment flask-capstone --type=ClusterIP --name=service-cluser-ip